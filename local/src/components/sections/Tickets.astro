---
import { Image } from "astro:assets";

import img1 from "../../assets/images/tickets/1.webp";
import img2 from "../../assets/images/tickets/3.webp";
import img3 from "../../assets/images/tickets/2.webp";

import imgF1 from "../../assets/images/tickets/i1.png";
import imgF2 from "../../assets/images/tickets/i2.png";
import imgF3 from "../../assets/images/tickets/i3.png";
import imgF4 from "../../assets/images/tickets/success.jpg";

const items = [
    {
        title: "–ú–∞–ª—ã–π –±–∏–∑–Ω–µ—Å",
        text: "–ü—Ä–æ—Å—Ç—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞ –≤ —Å–µ—Ç–∏ –±–µ–∑ –Ω–∞–π–º–∞ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤. ",
        link_text: "–ù–∞—á–Ω–µ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?",
        img: img1,
        imgModal: imgF1,
        classImg: "v1",
        key: 1,
    },
    {
        title: "Enterprise",
        text: "–ü–æ–≤—ã—à–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª–æ–≤ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤, –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –≤—ã—Ö–æ–¥–∞ –≤ –¢–û–ü.",
        link_text: "–°–¥–µ–ª–∞–µ–º —Ç–µ—Å—Ç",
        img: img2,
        imgModal: imgF2,
        classImg: "v2",
        key: 2,
    },
    {
        title: "–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã",
        text: "–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ –≤ —Å–º–µ–∂–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª—è—Ö.",
        link_text: "–†–∞—Å—à–∏—Ä–∏–º <br> –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫—É—é —Å–µ—Ç—å?",
        img: img3,
        imgModal: imgF3,
        classImg: "v3",
        key: 3,
    },
];
---

<section class="tickets section section--v1">
    <div class="container">
        <div class="tickets__inner">
            <div class="section__header">
                <h2 class="section__title">–î–ª—è –∫–∞–∂–¥–æ–≥–æ ‚Äî —Å–≤–æ–π Level Up</h2>
            </div>

            <div class="tickets__items">
                {
                    items.map((item) => (
                        <div
                            class={`tickets__item ticket ticket--${item.key}`}
                            data-micromodal-trigger="modal-order"
                            data-image={item.imgModal.src}
                            data-image-class={item.classImg}
                        >
                            <div class="ticket__inner">
                                <div class="ticket__left">
                                    <div class="ticket__content">
                                        <h3 class="ticket__title">
                                            {item.title}
                                        </h3>
                                        <p class="ticket__text">{item.text}</p>
                                    </div>
                                    <div class="ticket__image">
                                        <img
                                            src={item.img.src}
                                            class="img ticket__image-src"
                                            alt=""
                                        />
                                    </div>
                                </div>

                                <div class="ticket__right">
                                    <div class="ticket__link">
                                        <div
                                            class="ticket__link-text"
                                            set:html={item.link_text}
                                        />
                                        <svg
                                            width="15"
                                            height="27"
                                            viewBox="0 0 15 27"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                d="M15 11.75H11V15.75H15V11.75Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M11 14.75H7V18.75H11V14.75Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M8 18.75H4V22.75H8V18.75Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M4 22.75H0V26.75H4V22.75Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M4 0L0 0V4H4V0Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M8 3.875H4V7.875H8V3.875Z"
                                                fill="#101651"
                                            />
                                            <path
                                                d="M11 7.875H7V11.875H11V7.875Z"
                                                fill="#101651"
                                            />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ))
                }
            </div>
        </div>
    </div>
    <div class="modal micromodal-slide" id="modal-order" aria-hidden="true">
        <div class="modal__overlay" tabindex="-1" data-micromodal-close>
            <div
                class="modal__container"
                role="dialog"
                aria-modal="true"
                aria-labelledby="modal-order-title"
            >
                <div class="order">
                    <div class="order__inner">
                        <button
                            class="modal__close icon-close"
                            type="button"
                            aria-label="–ó–∞–∫—Ä—ã—Ç—å"
                            data-micromodal-close></button>

                        <div class="order__media">
                            <Image
                                src={imgF1}
                                alt=""
                                format="webp"
                                quality={90}
                                class="img order__img"
                            />
                        </div>

                        <div class="order__content">
                            <div class="order__init">
                                <div class="order__header">
                                    <h2
                                        class="order__title"
                                        id="modal-order-title"
                                    >
                                        –ú—ã –≥–æ—Ç–æ–≤—ã –∫ —Å—Ç–∞—Ä—Ç—É!
                                    </h2>
                                    <p class="order__text">
                                        –ü–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏ –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞—Ö ‚Äî –≤—Å–µ–≥–¥–∞ –Ω–∞
                                        —Å–≤—è–∑–∏. <br />
                                        –û—Ç –≤–∞—Å ‚Äî —Ç–æ–ª—å–∫–æ –∏–º—è –∏ –Ω–æ–º–µ—Ä.
                                    </p>
                                </div>
                                <form class="order__form">
                                    <div class="order__fields">
                                        <div class="order__field form-row">
                                            <input
                                                type="text"
                                                class="order__input input input-v1"
                                                placeholder="–ò–º—è"
                                                required
                                            />
                                        </div>
                                        <div class="order__field form-row">
                                            <input
                                                type="tel"
                                                class="order__input input input-v1"
                                                placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"
                                                required
                                            />
                                        </div>
                                    </div>

                                    <button
                                        type="submit"
                                        class="order__submit-btn btn btn--main btn--v3"
                                        >–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button
                                    >
                                    <p class="order__privacy">
                                        –ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É, –≤—ã –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ <br
                                        />
                                        –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É <a
                                            href="#"
                                            class="order__privacy-link link link--color-2"
                                            >–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a
                                        >
                                    </p>
                                </form>
                            </div>

                            <div class="order__success" style="display: none;">
                                <div class="order__success-media">
                                    <Image
                                        src={imgF4}
                                        alt=""
                                        format="webp"
                                        quality={90}
                                        class="img order__success-img"
                                    />
                                </div>
                                <div class="order__success-content">
                                    <h2 class="order__title order__success-title">
                                        –ü–æ–π–º–∞–ª–∏, —Å–∫–æ—Ä–æ –≤–µ—Ä–Ω—ë–º—Å—è! üëå
                                    </h2>
                                    <a
                                        href="/"
                                        class="order__submit-btn btn btn--main btn--v3"
                                        >–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a
                                    >
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    import MicroModal from "micromodal";

    document.addEventListener("DOMContentLoaded", () => {
        const triggers = document.querySelectorAll(
            '[data-micromodal-trigger="modal-order"]',
        );
        const modal = document.getElementById("modal-order");

        if (modal && triggers.length > 0) {
            const orderForm = modal.querySelector(
                ".order__form",
            ) as HTMLFormElement;
            const orderInit = modal.querySelector(
                ".order__init",
            ) as HTMLElement;
            const orderSuccess = modal.querySelector(
                ".order__success",
            ) as HTMLElement;

            if (orderForm) {
                orderForm.addEventListener("submit", (e) => {
                    e.preventDefault();
                    if (orderForm.checkValidity()) {
                        if (orderInit) orderInit.style.display = "none";
                        if (orderSuccess) orderSuccess.style.display = "block";
                        modal.classList.add("modal--success");
                    }
                });
            }

            triggers.forEach((trigger) => {
                trigger.addEventListener("click", () => {
                    const { image, imageClass } = (trigger as HTMLElement)
                        .dataset;
                    if (image) modal.dataset.activeImage = image;
                    if (imageClass)
                        modal.dataset.activeClass = `modal--${imageClass}`;
                });
            });

            MicroModal.init({
                onShow: (modalItem) => {
                    if (orderInit) orderInit.style.display = "block";
                    if (orderSuccess) orderSuccess.style.display = "none";
                    modalItem.classList.remove("modal--success");
                    orderForm?.reset();

                    const imageSrc = modalItem.dataset.activeImage;
                    const orderImage = modalItem.querySelector(
                        ".order__img",
                    ) as HTMLImageElement;
                    if (orderImage && imageSrc) orderImage.src = imageSrc;

                    const activeClass = modalItem.dataset.activeClass;
                    if (activeClass) {
                        modalItem.classList.forEach(
                            (cls) =>
                                cls.startsWith("modal--") &&
                                modalItem.classList.remove(cls),
                        );
                        modalItem.classList.add(activeClass);
                    }
                },
                onClose: (modalItem) => {
                    const activeClass = modalItem.dataset.activeClass;
                    if (activeClass) modalItem.classList.remove(activeClass);
                },
                disableScroll: true,
                awaitCloseAnimation: true,
                disableFocus: true,
            });
        }
    });
</script>
